{% extends "base.html" %}
{% block title %}Registrar Compra{% endblock %}
{% block content %}
<style>
  .formulario {
    max-width: 700px;
    margin: auto;
    padding: 20px;
  }

  .formulario label {
    display: block;
    margin-bottom: 4px;
    font-weight: bold;
    text-align: left;
  }

  .formulario input,
  .formulario select,
  .formulario textarea {
    width: 100%;
    padding: 6px;
    margin-bottom: 15px;
    text-align: right;
    border-radius: 4px;
    border: 1px solid #ccc;
  }

  .fila-doble {
    display: flex;
    gap: 16px;
    flex-wrap: wrap;
  }

  .fila-doble > div {
    flex: 1 1 45%;
  }

  .botones {
    text-align: center;
    margin-top: 25px;
  }

  .btn-cancelar {
    background-color: #dc3545;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
    margin-right: 15px;
    text-decoration: none;
  }

  .btn-guardar {
    background-color: #198754;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
  }

  .btn-cancelar:hover,
  .btn-guardar:hover {
    opacity: 0.9;
    cursor: pointer;
  }

  .mensaje-exito {
    background-color: #d1e7dd;
    color: #0f5132;
    border: 1px solid #badbcc;
    padding: 10px;
    margin-bottom: 10px;
    border-radius: 4px;
  }

  .mensaje-alerta {
    background-color: #fff3cd;
    color: #664d03;
    border: 1px solid #ffecb5;
    padding: 10px;
    margin-bottom: 10px;
    border-radius: 4px;
  }

  .mensaje-error {
    background-color: #f8d7da;
    color: #842029;
    border: 1px solid #f5c2c7;
    padding: 10px;
    margin-bottom: 10px;
    border-radius: 4px;
  }

  .grupo-proveedor {
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .grupo-proveedor button span {
    color: white !important;
  }
</style>

<div class="formulario">
  <h2 style="text-align: center; margin-bottom: 20px;">üßæ Registrar Compra</h2>

  <!-- Mensajes -->
  {% with mensajes = get_flashed_messages() %}
    {% if mensajes %}
      {% for msg in mensajes %}
        {% if "‚úÖ" in msg %}
          <div class="mensaje-exito">{{ msg }}</div>
        {% elif "‚ö†Ô∏è" in msg %}
          <div class="mensaje-alerta">{{ msg }}</div>
        {% elif "‚ùå" in msg %}
          <div class="mensaje-error">{{ msg }}</div>
        {% endif %}
      {% endfor %}
    {% endif %}
  {% endwith %}

  <form method="POST">
    <div class="fila-doble">
      <div>
        <label>Fecha:</label>
        <input type="date" name="Fecha" required>
      </div>

      <div>
        <label>N¬∞ Documento:</label>
        <input type="text" name="N_Documento" required>
      </div>
    </div>

    <div class="fila-doble">
      <div>
        <label>Proveedor:</label>
        <div class="grupo-proveedor">
          <select name="Proveedor" class="form-select" style="flex: 1;" required>
            <option value="">Seleccione...</option>
            {% for p in proveedores %}
              <option value="{{ p }}" {% if p == seleccionado %}selected{% endif %}>{{ p }}</option>
            {% endfor %}
          </select>
          <button type="button" class="btn btn-primary" style="padding: 5px 12px;" data-bs-toggle="modal" data-bs-target="#modalProveedor">
            <span>‚ûï</span>
          </button>
        </div>
      </div>

      <div>
        <label>Producto:</label>
        <select name="Producto" required>
          <option value="">Seleccione...</option>
          {% for p in productos %}
            <option value="{{ p }}">{{ p }}</option>
          {% endfor %}
        </select>
      </div>
    </div>

    <div class="fila-doble">
      <div>
        <label>Cantidad:</label>
        <input type="number" name="Cantidad" step="any" required>
      </div>

      <div>
        <label>Precio Unitario:</label>
        <input type="number" name="PrecioUnitario" step="any" required>
      </div>
    </div>

    <div class="fila-doble">
      <div>
        <label>Moneda:</label>
        <select name="Moneda" required>
          <option value="">Seleccione...</option>
          <option value="‚Ç°">‚Ç°</option>
          <option value="$">$</option>
          <option value="‚Ç¨">‚Ç¨</option>
        </select>
      </div>

      <div>
        <label>Forma de Pago:</label>
        <select name="Forma_Pago" required>
          <option value="">Seleccione...</option>
          <option value="Efectivo">Efectivo</option>
          <option value="SINPE">SINPE</option>
          <option value="Tarjeta Cr.">Tarjeta Cr.</option>
        </select>
      </div>
    </div>

    <div>
      <label>Observaciones:</label>
      <textarea name="Observaciones" rows="2"></textarea>
    </div>

    <div class="botones">
      <a href="/" class="btn-cancelar">Cancelar</a>
      <button type="submit" class="btn-guardar">Guardar</button>
    </div>
  </form>
</div>

<!-- Modal para Nuevo Proveedor -->
<div class="modal fade" id="modalProveedor" tabindex="-1" aria-labelledby="modalProveedorLabel" aria-hidden="true">
  <div class="modal-dialog">
    <form class="modal-content" method="POST" action="/nuevo_proveedor">
      <div class="modal-header">
        <h5 class="modal-title" id="modalProveedorLabel">‚ûï Nuevo Proveedor</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label for="NombreProveedor" class="form-label">Nombre del Proveedor</label>
          <input type="text" class="form-control" name="NombreProveedor" required>
        </div>
        <div class="mb-3">
          <label for="ContactoProveedor" class="form-label">Contacto</label>
          <input type="text" class="form-control" name="ContactoProveedor">
        </div>
        <div class="mb-3">
          <label for="TelefonoProveedor" class="form-label">Tel√©fono</label>
          <input type="text" class="form-control" name="TelefonoProveedor">
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button type="submit" class="btn btn-success">Guardar Proveedor</button>
      </div>
    </form>
  </div>
</div>
{% endblock %}

